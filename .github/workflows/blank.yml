name: Ping and Notify

on:
  schedule:
    - cron: "*/5 * * * *"   # ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
  workflow_dispatch:

jobs:
  check-ip:
    runs-on: ubuntu-latest
    steps:
      - name: Resolve domain to IP silently
        id: dns
        run: |
          DOMAIN="${{ secrets.IP }}"
          IP=$(dig +short "$DOMAIN" | tail -n1)
          TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")
          # ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô environment variable ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ
          echo "DOMAIN=$DOMAIN" >> $GITHUB_ENV
          echo "IP=$IP" >> $GITHUB_ENV
          echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
          # ‡πÑ‡∏°‡πà echo IP ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‚Üí log ‡∏Ç‡∏≠‡∏á GitHub ‡∏à‡∏∞ clean

      - name: Send Telegram message
        run: |
          if [[ "$IP" == 1.* ]]; then
            MESSAGE="‚ö†Ô∏èüö® ALERT! Domain $DOMAIN resolved to CRITICAL IP $IP at $TIMESTAMP üö®‚ö†Ô∏è"
          else
            MESSAGE="‚úÖ Domain $DOMAIN checked at $IP at $TIMESTAMP"
          fi

          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="$MESSAGE"
